---
title: "Processed Data"
date: 2023-02-14
output:
  html_document:
    toc: true
    toc_depth: 3
---

# Logic Flow

[Quantitation Reference Powerpoint](https://uflorida-my.sharepoint.com/:p:/g/personal/camden_camacho_ufl_edu/EaVbQvErEnNKpVYSX4BhQ-EB34x2tahj1mSEbT9KeP13_Q?rtime=REwgXe8f20g)

## Calculation Steps

```{r echo=FALSE}
DiagrammeR::grViz("digraph {

graph [layout = dot]

# define the global styles of the nodes. We can override these in box if we wish
node [shape = rectangle, style = filled, fillcolor = white]


step1 [label = 'Build the Calibration Curve (see Building the Calibration Section)']
step2 [label = 'Quantifying the Samples (see Quantifying Samples Section)']
step3 [label = 'Produce Data outputs (TBD)']

# edge definitions with the node IDs
step1 -> step2 -> step3
}")
```

### Building the Calibration Curve

#### Calculate Average Peak Ratio

##### Build Average Peak Area Table

```{r, echo=FALSE}
DiagrammeR::grViz("digraph {
    //
    // Defaults
    //

    // Box for entities
    node [shape=none, margin=0]

    // One-to-many relation (from one, to many)
    edge [arrowtail=none, dir=both]

    //
    // Entities
    //
    individual_native_analyte [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>individual_native_analyte</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>filename: text</td></tr>
            <tr><td align='left'>replicate_number: text</td></tr>
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>individual_native_analyte_peak_area: numeric</td></tr>
        </table>
    >]

    internal_standard [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>internal_standard</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>filename: text</td></tr>
            <tr><td align='left'>replicate_number: text</td></tr>
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>internal_standard_peak_area: numeric</td></tr>
        </table>
    >]


    native_analyte_internal_standard_mapping [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>native_analyte_internal_standard_mapping</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
        </table>
    >]

    average_peak_area_ratio_calculation_input [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>average_peak_area_ratio_calculation_input</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>filename: text</td></tr>
            <tr><td align='left'>replicate_number: text</td></tr>
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>individual_native_analyte_peak_area: numeric</td></tr>
            <tr><td align='left'>internal_standard_peak_area: numeric</td></tr>
        </table>
    >]

    internal_standard_max_calibration_level [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>internal_standard_max_calibration_level</td></tr>
            // columns
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>max_calibration_level: numeric</td></tr>
        </table>
    >]

    batch_error_filename [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>batch_error_filename</td></tr>
            // columns
            <tr><td align='left'>batch_number: text</td></tr>
            <tr><td align='left'>filename: text</td></tr>
        </table>
    >]


    step2 [label = 'Filter out Configurable Data from Source for a Given Batch
    1. Internal Standard: Remove calibrations above a set max calibration level
    2. Remove a known bad filename', shape = rectangle, style = filled, fillcolor = white]



    //
    // Relationships
    //

    individual_native_analyte -> batch_error_filename
    internal_standard -> internal_standard_max_calibration_level
    batch_error_filename -> step2
    internal_standard_max_calibration_level-> step2

    step2 -> native_analyte_internal_standard_mapping
    native_analyte_internal_standard_mapping -> average_peak_area_ratio_calculation_input
}")
```

##### Calculate Average Peak Area

```{r echo=FALSE}
DiagrammeR::grViz("digraph {

graph [layout = dot]
node [shape = rectangle, style = filled, fillcolor = white]

sourceSample [label = 'SetX_XXX_XXX_short.XLS', shape = folder, fillcolor = linen]

sourceReference [label = 'Native_analyte_ISmatch_source.xlsx', shape = folder, fillcolor = linen]

average_analyte_peak_area_ratio [label = 'average_analyte_peak_area_ratio', shape = folder, fillcolor = lightblue]

stepFilter [label = 'Filter out Configurable Data from Source for a Given Batch
    1. Internal Standard: Remove calibrations above a set max calibration level
    2. Remove a known bad filename', shape = rectangle, style = filled, fillcolor = white]

step1 [label = 'Join Analyte Peak Area with corresponding Internal Standard Peak Area
Using Reference Native_analyte_ISmatch_source.xlsx to get the associated Internal Standard
Joining on Corresponding Internal Standard + Filename']

step2 [label = 'Calculate Analyte Peak Area Ratio
Analyte Peak Area Ratio = Analyte Peak Area / Internal Standard Peak Area']

step3 [label = 'For a given Analyte + Calibration Level, calculate Average Analyte Peak Area Ratio']

sourceReference -> step1
sourceSample -> stepFilter -> step1 -> step2 -> step3 -> average_analyte_peak_area_ratio
}")
```

##### Average Peak Area Ratio Output

```{r, echo=FALSE}
DiagrammeR::grViz("digraph {


    // Box for entities
    node [shape=none, margin=0]

    average_peak_area_ratio_calculation_input [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>average_peak_area_ratio_calculation_input</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>filename: text</td></tr>
            <tr><td align='left'>replicate_number: text</td></tr>
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>individual_native_analyte_peak_area: numeric</td></tr>
            <tr><td align='left'>internal_standard_peak_area: numeric</td></tr>
            <tr><td align='left'>analyte_peak_area_ratio: numeric</td></tr>
        </table>
    >]

    average_peak_area_ratio [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>average_peak_area_ratio</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>average_analyte_peak_area_ratio: numeric</td></tr>
        </table>
    >]

   average_peak_area_ratio_calculation_input -> average_peak_area_ratio
}")
```

#### Calculate Concentration Ratio

##### Build Concentration Ratio Table

```{r, echo=FALSE}
DiagrammeR::grViz("digraph {


    // Box for entities
    node [shape=none, margin=0]

    native_analyte_internal_standard_mapping [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>native_analyte_internal_standard_mapping</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
        </table>
    >]

    native_analyte_concentration [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>native_analyte_concentration</td></tr>
            // columns
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>calibration_mix: text</td></tr>
            <tr><td align='left'>native_analyte_name: text</td></tr>
            <tr><td align='left'>native_analyte_concentration_ppt: numeric</td></tr>
        </table>
    >]

    internal_standard_concentration [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>internal_standard_concentration</td></tr>
            // columns
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>calibration_mix: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>internal_standard_concentration_ppt: numeric</td></tr>
        </table>
    >]



    analyte_concentration_ratio_calculation_input [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>analyte_concentration_ratio_calculation_input</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>native_analyte_concentration_ppt: numeric</td></tr>
            <tr><td align='left'>internal_standard_concentration_ppt: numeric</td></tr>
        </table>
    >]


native_analyte_internal_standard_mapping -> analyte_concentration_ratio_calculation_input
native_analyte_concentration -> native_analyte_internal_standard_mapping
internal_standard_concentration -> native_analyte_internal_standard_mapping
}")
```

##### Calculate Concentration Ratio

```{r echo=FALSE}
DiagrammeR::grViz("digraph {

graph [layout = dot]

node [shape = rectangle, style = filled, fillcolor = white]


sourceCalCurve [label = 'Sep2021Calibration_Curve_source.xlsx', shape = folder, fillcolor = linen]

internal_standard [label = 'internal_standard_concentration', shape = folder, fillcolor = lightblue]

native_analyte [label = 'native_analyte_concentration', shape = folder, fillcolor = lightblue]


analyte_concentration_ratio [label = 'analyte_concentration_ratio', shape = folder, fillcolor = lightblue]


step4 [label = 'Join the Average Analyte Peak Area Ratio to
1. Native Analyte Concentration On Native Analyte Name + Calibration Level
2. Internal Standard Concentration On Referenced Internal Standard Name + Calibration Level
']

step5 [label = 'Calculate Concentration Ratio:
Analyte Concentration Ratio = Native Analyte Concentration / Internal Standard Concentration']


sourceCalCurve -> internal_standard -> step4
sourceCalCurve -> native_analyte -> step4

step4 -> step5 -> analyte_concentration_ratio

}")
```


##### Concentration Ratio Output

```{r, echo=FALSE}
DiagrammeR::grViz("digraph {


    // Box for entities
    node [shape=none, margin=0]

    analyte_concentration_ratio_calculation_input [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>analyte_concentration_ratio_calculation_input</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>native_analyte_concentration_ppt: numeric</td></tr>
            <tr><td align='left'>internal_standard_concentration_ppt: numeric</td></tr>
        </table>
    >]

    analyte_concentration_ratio [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>analyte_concentration_ratio</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>calibration_level: numeric</td></tr>
            <tr><td align='left'>analyte_concentration_ratio: numeric</td></tr>
        </table>
    >]

   analyte_concentration_ratio_calculation_input -> analyte_concentration_ratio
}")
```

##### Calibration Curve Input

```{r echo=FALSE}
DiagrammeR::grViz("digraph {


    // Box for entities
    node [shape=none, margin=0]

    analyte_reference_table [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>analyte_reference_table</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>minimum_limit_of_quantitation: text</td></tr>
        </table>
    >]

    average_peak_area_ratio [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>average_peak_area_ratio</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>average_analyte_peak_area_ratio: numeric</td></tr>
        </table>
    >]

    analyte_concentration_ratio [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>analyte_concentration_ratio</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>calibration_level: numeric</td></tr>
            <tr><td align='left'>concentration_ratio: numeric</td></tr>
        </table>
    >]

    calibration_curve_input [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>calibration_curve_input</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>calibration_level: numeric</td></tr>
            <tr><td align='left'>average_peak_area_ratio: numeric</td></tr>
            <tr><td align='left'>analyte_concentration_ratio: numeric</td></tr>
        </table>
    >]

step4 [label = 'Remove Calibration Levels below Limit of Quantitation (LOQ) for each Native Analyte', shape = rectangle, style = filled, fillcolor = white]

average_peak_area_ratio -> step4
analyte_concentration_ratio -> step4
analyte_reference_table -> step4

step4 -> calibration_curve_input
}")
```

##### Calculate Calibration Curve

```{r echo=FALSE}
DiagrammeR::grViz("digraph {

graph [layout = dot]

node [shape = rectangle, style = filled, fillcolor = white]

calibration_curve_input [label = 'calibration_curve_input', shape = folder, fillcolor = lightblue]

calibration_curve_with_recovery_output [label = 'calibration_curve_with_recovery_output', shape = folder, fillcolor = lightblue]

calibration_curve_no_recovery_output [label = 'calibration_curve_no_recovery_output', shape = folder, fillcolor = lightblue]

calibration_curve_troubleshoot [label = 'calibration_curve_troubleshoot', shape = folder, fillcolor = lightblue]

calibration_recovery_troubleshoot [label = 'calibration_recovery_troubleshoot', shape = folder, fillcolor = lightblue]

step6 [label = 'Calculate slope and intercept of the cal curve:
y-axis = Average Peak Area Ratio
x-axis = Analyte Concentration Ratio']

step62 [label = 'Recalculate slope and intercept of the cal curve after recovery:
y-axis = Average Peak Area Ratio
x-axis = Analyte Concentration Ratio']

step7 [label = 'Is R^2 < 0.99 or R^2 >= 0.99?', shape = diamond]

step8 [label = 'Remove single lower and then upper level until R^2 >= 0.99']

step9 [label = 'Calculate Experimental Cocentration Ratio
Experimental Cocentration Ratio = (Average Peak Area Ratio - Intercept)/Slope
']

step10 [label = 'Calculate Recovery
Recovery = Experimental Cocentration Ratio / Analyte Concentration Ratio
']

step11 [label = '0.8 <= Recovery <= 1.2', shape = diamond]

step12 [label = 'Remove Calibration Levels with out of bounds Recovery Value']

calibration_curve_input -> step6
step6 -> step7

step7 -> calibration_curve_no_recovery_output [label = 'R^2 >= 0.99']
calibration_curve_no_recovery_output -> step9
step7 -> step8  [label = 'R^2 < 0.99']
step9 -> step10 -> step11
step11 -> calibration_curve_with_recovery_output [label = 'All Recovery Values in Bounds']
step11 -> step12 [label = 'Recovery Value(s) out of Bounds']
step8 -> step6
step12 -> step62
step8 -> calibration_curve_troubleshoot
step12 -> calibration_recovery_troubleshoot
step62 -> calibration_curve_with_recovery_output

}")
```

##### Calibration Curve Output

```{r echo=FALSE}
DiagrammeR::grViz("digraph {


    // Box for entities
    node [shape=none, margin=0]

  calibration_curve_troubleshoot [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>calibration_curve_troubleshoot</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>calibration_range: text</td></tr>
            <tr><td align='left'>r_squared: numeric</td></tr>
        </table>
    >]

  calibration_recovery_troubleshoot [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>calibration_recovery_troubleshoot</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>experimental_concentration_ratio: numeric</td></tr>
            <tr><td align='left'>analyte_concentration_ratio: numeric</td></tr>
            <tr><td align='left'>recovery: numeric</td></tr>
        </table>
    >]


    calibration_curve_with_recovery_output [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>calibration_curve_with_recovery_output</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>average_analyte_peak_area_ratio: numeric</td></tr>
            <tr><td align='left'>slope: numeric</td></tr>
            <tr><td align='left'>y_intercept: numeric</td></tr>
            <tr><td align='left'>r_squared: numeric</td></tr>
            <tr><td align='left'>calibration_range: text</td></tr>
            <tr><td align='left'>removed_calibration_levels: text</td></tr>
            <tr><td align='left'>minimum_average_peak_area_ratio: numeric</td></tr>
            <tr><td align='left'>maximum_average_peak_area_ratio: numeric</td></tr>
        </table>
    >]

    calibration_curve_no_recovery_output [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>calibration_curve_no_recovery_output</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>average_analyte_peak_area_ratio: numeric</td></tr>
            <tr><td align='left'>slope: numeric</td></tr>
            <tr><td align='left'>y_intercept: numeric</td></tr>
            <tr><td align='left'>r_squared: numeric</td></tr>
            <tr><td align='left'>calibration_range: text</td></tr>
            <tr><td align='left'>removed_calibration_levels: text</td></tr>
            <tr><td align='left'>minimum_average_peak_area_ratio: numeric</td></tr>
            <tr><td align='left'>maximum_average_peak_area_ratio: numeric</td></tr>
        </table>
    >]

}")
```

### Quantifying Samples

The "calibration_curve_output" output table represents both the calibration curve when calcualted with and without recovery.

#### Build Table for Analyte Concentration Calculation

##### Build Limit of Detection Table (for With and Without Recovery)

```{r echo=FALSE}
DiagrammeR::grViz("digraph {


    // Box for entities
    node [shape=none, margin=0]

  analyte_limit_of_detection_reference [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>analyte_limit_of_detection_reference</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>limit_of_detection_cal_level: text</td></tr>
        </table>
    >]

  average_peak_area_ratio [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>average_peak_area_ratio</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>calibration_level: text</td></tr>
            <tr><td align='left'>average_analyte_peak_area_ratio: numeric</td></tr>
        </table>
    >]


  calibration_curve_output [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>calibration_curve_output</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>slope: numeric</td></tr>
            <tr><td align='left'>y_intercept: numeric</td></tr>
        </table>
    >]

  analyte_limit_of_detection [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>analyte_limit_of_detection_reference</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>limit_of_detection_cal_level: text</td></tr>
            <tr><td align='left'>limit_of_detection_area_ratio: text</td></tr>
            <tr><td align='left'>limit_of_detection_concentration_ng: numeric</td></tr>
        </table>
    >]

build_table [label = 'Use the configured Cal Level for a given Analyte to determine the Limit of Detection (LoD).
If there does not exist an average_analyte_peak_area_ratio for the configured LoD level, will find the lowest cal level above the configured LoD value.
', shape = rectangle, style = filled, fillcolor = white]

calc_limit_of_detection [label = 'limit_of_detection_concentration_ng = (limit_of_detection_area_ratio - intercept)/slope', shape = rectangle, style = filled, fillcolor = white]

lod_area_ratio [label = 'limit_of_detection_area_ratio = The average_analyte_peak_area_ratio for Configured Cal Level', shape = rectangle, style = filled, fillcolor = white]

analyte_limit_of_detection_reference -> build_table
average_peak_area_ratio -> build_table
calibration_curve_output -> build_table
build_table -> lod_area_ratio
lod_area_ratio -> calc_limit_of_detection
calc_limit_of_detection -> analyte_limit_of_detection
}")
```

##### Build Sample Peak Ratio Table

The batch number is noted when processing the sample in order to tie to the appropriate extraction_batch_source.

The filename matches to cartridge_number in the extraction_batch_sources file.

```{r echo=FALSE}
DiagrammeR::grViz("digraph {


  // Box for entities
  node [shape=none, margin=0]

  batch_error_filename [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>batch_error_filename</td></tr>
            // columns
            <tr><td align='left'>batch_number: text</td></tr>
            <tr><td align='left'>filename: text</td></tr>
        </table>
    >]

  individual_native_analyte [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>individual_native_analyte</td></tr>
            // columns
            <tr><td align='left'>batch_number: text</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>filename: text</td></tr>
            <tr><td align='left'>individual_native_analyte_area: numeric</td></tr>
        </table>
    >]

  internal_standard [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>internal_standard</td></tr>
            // columns
            <tr><td align='left'>batch_number: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>filename: text</td></tr>
            <tr><td align='left'>internal_standard_area: numeric</td></tr>
        </table>
    >]

    native_analyte_internal_standard_mapping [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>native_analyte_internal_standard_mapping</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
        </table>
    >]

    calc_peak_area_ratio [label = 'peak_area_ratio = individual_native_analyte_area / internal_standard_area', shape = rectangle, style = filled, fillcolor = white]


  peak_area_ratio [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>peak_area_ratio</td></tr>
            // columns
            <tr><td align='left'>batch_number: text</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>catridge_number: integer</td></tr>
            <tr><td align='left'>individual_native_analyte_area: numeric</td></tr>
            <tr><td align='left'>internal_standard_area: numeric</td></tr>
            <tr><td align='left'>peak_area_ratio: numeric</td></tr>
        </table>
    >]

    individual_native_analyte -> native_analyte_internal_standard_mapping
    internal_standard -> native_analyte_internal_standard_mapping
    native_analyte_internal_standard_mapping -> batch_error_filename
    batch_error_filename -> calc_peak_area_ratio -> peak_area_ratio

}")
```

##### Build Analyte Concentration Calculation Table

```{r echo=FALSE}
DiagrammeR::grViz("digraph {


  // Box for entities
  node [shape=none, margin=0]


  peak_area_ratio [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>peak_area_ratio</td></tr>
            // columns
            <tr><td align='left'>batch_number: text</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>catridge_number: integer</td></tr>
            <tr><td align='left'>individual_native_analyte_area: numeric</td></tr>
            <tr><td align='left'>internal_standard_area: numeric</td></tr>
            <tr><td align='left'>peak_area_ratio: numeric</td></tr>
        </table>
    >]

  analyte_limit_of_detection_reference [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>analyte_limit_of_detection_reference</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>limit_of_detection_cal_level: text</td></tr>
            <tr><td align='left'>limit_of_detection_area_ratio: text</td></tr>
            <tr><td align='left'>limit_of_detection_concentration_ng: numeric</td></tr>
        </table>
    >]


    calibration_curve_output [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>calibration_curve_output</td></tr>
            // columns
            <tr><td align='left'>batch_number: text</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>slope: numeric</td></tr>
            <tr><td align='left'>y_intercept: numeric</td></tr>
            <tr><td align='left'>minimum_average_peak_area_ratio: numeric</td></tr>
            <tr><td align='left'>maximum_average_peak_area_ratio: numeric</td></tr>
        </table>
    >]

    extraction_batch_source [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>extraction_batch_source</td></tr>
            // columns
            <tr><td align='left'>batch_number: integer</td></tr>
            <tr><td align='left'>catridge_number: integer</td></tr>
            <tr><td align='left'>internal_standard_used: text</td></tr>
        </table>
    >]

    internal_standard_mix [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>internal_standard_mix</td></tr>
            // columns
            <tr><td align='left'>internal_standard_mix: text</td></tr>
            <tr><td align='left'>stock_mix: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>internal_standard_concentration_ppb: float</td></tr>
        </table>
    >]

    analyte_concentration_calculation_input [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>analyte_concentration_calculation_input</td></tr>
            // columns
            <tr><td align='left'>batch_number: text</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>internal_standard_name: text</td></tr>
            <tr><td align='left'>internal_standard_used: text</td></tr>
            <tr><td align='left'>internal_standard_concentration_ng (C_IS): numeric</td></tr>
            <tr><td align='left'>slope (m): numeric</td></tr>
            <tr><td align='left'>y_intercept (b): numeric</td></tr>
            <tr><td align='left'>peak_area_ratio (A_R): numeric</td></tr>
            <tr><td align='left'>minimum_average_peak_area_ratio: numeric</td></tr>
            <tr><td align='left'>maximum_average_peak_area_ratio: numeric</td></tr>
            <tr><td align='left'>limit_of_detection_area_ratio: numeric</td></tr>
            <tr><td align='left'>limit_of_detection_concentration_ng: numeric</td></tr>
        </table>
    >]

step2 [label = 'Calculate the Amount of Internal Standard in each Sample
1. Internal Standard Concentration (ng/g) or (ppb) * 1000
2. Internal Standard Concentration (nglL) or (ppt) / 1000000
3. Internal Standard Concentration ng/uL * 25', shape = rectangle, style = filled, fillcolor = white]


    peak_area_ratio -> calibration_curve_output [label = 'Join Calculated Calibration Curve Table \n on Native Analyte Name']
    peak_area_ratio -> extraction_batch_source [label = 'Join Extraction Batch Source \non batch_number and cartridge_number']
    extraction_batch_source -> internal_standard_mix [label = 'Join Internal Standard Mix on\nInternal Standard Used and Internal Standard Name']
    peak_area_ratio -> internal_standard_mix
    internal_standard_mix -> step2 -> analyte_concentration_calculation_input
    analyte_limit_of_detection_reference -> analyte_concentration_calculation_input [label = 'Add Limit of Detection for use when calculating Calibration_Curve_Range_Category']

}")
```

#### Calculate Analyte Concentration (Same calculations for with Recovery and without Recovery Filtering)

```{r echo=FALSE}
DiagrammeR::grViz("digraph {

graph [layout = dot]

node [shape = rectangle, style = filled, fillcolor = white]

// sourced tables
isMixSource [label = 'IS_Mix_source.xlsx', shape = folder, fillcolor = linen]
extractionBatchSource [label = 'Extraction_Batches_source.xlsx', shape = folder, fillcolor = linen]


// calcualted tables
peak_area_ratio [label = 'peak_area_ratio', shape = folder, fillcolor = lightblue]
calibration_curve_output [label = 'calibration_curve_output', shape = folder, fillcolor = lightblue]
analyte_limit_of_detection_reference [label = 'analyte_limit_of_detection_reference', shape = folder, fillcolor = lightblue]

analyte_concentration_calculation_input [label = 'analyte_concentration_calculation_input', shape = folder, fillcolor = lightblue]

analyte_concentration [label = 'analyte_concentration', shape = folder, fillcolor = lightblue]


step3 [label = 'C_a = ((A_R - b) / m) * C_IS
C_a = concentration of analyte
A_R = peak area ratio
b = y-intercept of cal curve trendline
m = slope of cal curve trendline
C_IS = concentration of internal standard']

step4 [label = 'Evaluate Calibration_Curve_Range_Category
Area Ratio < Instrument Limit of Detection Area Ratio = <LOD
Area Ratio < Calibration Curve Minimum Average Peak Area Ratio = <LOQ
Area Ratio within bounds = Within Calibration Range
Area Ratio > Calibration Curve Maximum Average Peak Area Ratio = Above Cal
']


analyte_limit_of_detection_reference -> analyte_concentration_calculation_input
peak_area_ratio -> analyte_concentration_calculation_input
calibration_curve_output -> analyte_concentration_calculation_input
extractionBatchSource -> analyte_concentration_calculation_input
isMixSource -> analyte_concentration_calculation_input

analyte_concentration_calculation_input -> step4

step4 -> step3 -> analyte_concentration
}")
```


##### Quantify Sample Table Outputs


```{r echo=FALSE}
DiagrammeR::grViz("digraph {


    // Box for entities
    node [shape=none, margin=0]

    analyte_concentration_with_and_without_recovery [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>analyte_concentration (with and without recovery)</td></tr>
            // columns
            <tr><td align='left'>batch_number: text</td></tr>
            <tr><td align='left'>cartridge_number: text</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>analyte_detection_flag: text</td></tr>
            <tr><td align='left'>calibration_curve_range_category: text</td></tr>
            <tr><td align='left'>limit_of_detection_concentration_ng: numeric</td></tr>
            <tr><td align='left'>analyte_concentration_ng: numeric</td></tr>
        </table>
    >]

}")
```

### Produce Data Outputs

#### Build Blank Filtering Table

Build a blank filtering table.


```{r echo=FALSE}
DiagrammeR::grViz("digraph {

  node [shape=none, margin=0]



    // sourced tables
    extractionBatchSource [label = 'Extraction_Batches_source.xlsx', shape = folder, style = filled, fillcolor = linen]
    analyte_concentration [label = 'analyte_concentration', shape = folder, style = filled, fillcolor = lightblue]


    step1 [label = 'Filter to Extraction Blank values from Raw Source data using County == Extraction Blank', shape = rectangle, style = filled, fillcolor = white]

    step2 [label = 'Based on when calibration_curve_range_category is <LOD or <LOQ
    If <LOD = Set analyte_concentration_ng to 0.0
    If <LOQ = Set analyte_concentration_ng to limit_of_detection_concentration_ng/2^0.5
    ', shape = rectangle, style = filled, fillcolor = white]

    analyte_concen_nf [label = 'If the extraction blank analyte_concentration_ng is NF, set to 0.0', shape = rectangle, style = filled, fillcolor = white]




    step3 [label = 'Calculate average_extraction_blank_analyte_concentration_ng by:
    1. batch_number
    2. individual_native_analyte_name', shape = rectangle, style = filled, fillcolor = white]


    blank_sample_average_analyte_concentration [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>blank_sample_average_analyte_concentration</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>average_extraction_blank_analyte_concentration_ng: numeric</td></tr>
        </table>
    >]

    extractionBatchSource -> step1
    analyte_concentration -> step1

    step1 -> analyte_concen_nf -> step2
    step2 -> step3
    step3 -> blank_sample_average_analyte_concentration

}")
```


#### Subtract Blank Filtered Values from

```{r echo=FALSE}
DiagrammeR::grViz("digraph {

  node [shape=none, margin=0]



    // sourced tables
    analyte_concentration [label = 'analyte_concentration', shape = folder, style = filled, fillcolor = lightblue]
    blank_sample_average_analyte_concentration [label = 'blank_sample_average_analyte_concentration', shape = folder, style = filled, fillcolor = lightblue]

    step1 [label = 'Join blank_sample_average_analyte_concentration to analyte_concentration_calculation_input on
    1. batch_number
    2. cartridge_number
    3. individual_native_analyte_name', shape = rectangle, style = filled, fillcolor = white]

    step2 [label = 'Calculate blank_filtered_analyte_concnetration_ng with:
    blank_filtered_analyte_concnetration_ng = analyte_concentration_ng - average_extraction_blank_analyte_concentration_ng', shape = rectangle, style = filled, fillcolor = white]

    blank_filtered_analyte_concentration [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>blank_filtered_analyte_concentration</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>cartridge_number: text</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>blank_filtered_analyte_concnetration_ng: numeric</td></tr>
        </table>
    >]


    analyte_concentration -> step1
    blank_sample_average_analyte_concentration -> step1
    step1 -> step2
    step2 -> blank_filtered_analyte_concentration

}")
```

#### Build Quality Control Table

```{r echo=FALSE}
DiagrammeR::grViz("digraph {


    // Box for entities
    node [shape=none, margin=0]

  blank_filtered_analyte_concentration [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>blank_filtered_analyte_concentration</td></tr>
            // columns
            <tr><td align='left'>batch_number: text</td></tr>
            <tr><td align='left'>cartridge_number: text</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>analyte_concentration_ng: numeric</td></tr>
        </table>
    >]

  extraction_batch_sources [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>extraction_batch_sources</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>cartridge_number: text</td></tr>
            <tr><td align='left'>county: text</td></tr>
            <tr><td align='left'>sample_id: text</td></tr>
        </table>
    >]


build_table [label = 'Join blank_filtered_analyte_concentration with extraction_batch_sources on
batch_number and cartridge_number', shape = rectangle, style = filled, fillcolor = white]

    step1 [label = 'Filter to Quality Control values from Raw Source data using County == Fresh Water QC or Salt Water QC', shape = rectangle, style = filled, fillcolor = white]

    set_sample_type [label = 'Set sample_type to Fresh Water QC or Salt Water QC depending on County Value', shape = rectangle, style = filled, fillcolor = white]

    parse_out_level_and_rep [label = 'Pull out Quality Levels (Low, Medium, and High) and Replicate Number (1, 2, and 3) from sample_id', shape = rectangle, style = filled, fillcolor = white]


  quality_control_calculation_input [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>quality_control_calculation_input</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>quality_control_sample_type: text</td></tr>
            <tr><td align='left'>sample_id: text</td></tr>
            <tr><td align='left'>quality_control_level: text</td></tr>
            <tr><td align='left'>quality_control_replicate: text</td></tr>
            <tr><td align='left'>blank_filtered_analyte_concentration_ng: numeric</td></tr>
        </table>
    >]


blank_filtered_analyte_concentration -> build_table
extraction_batch_sources -> build_table
build_table -> step1 -> set_sample_type -> parse_out_level_and_rep -> quality_control_calculation_input


}")
```

#### Calculate Quality Control Levels

Sample Type is not included in this table because in the reference material "reference/native_analyte_quality_control_levels.xlsx", there is only the analyte name and the QC mix of High, Medium, and Low to reference to.

```{r echo=FALSE}
DiagrammeR::grViz("digraph {

  node [shape=none, margin=0]



    // sourced tables
    quality_control_calculation_input [label = 'quality_control_calculation_input', shape = folder, style = filled, fillcolor = lightblue]

    quality_control_sample_adjustment [label = 'quality_control_sample_adjustment', shape = folder, style = filled, fillcolor = linen]


subtract_sample_adjustment [label = 'For each individual_native_analyte_name and quality_control_sample_type, subtract the corresponidng ng_to_filter_ng amount', shape = rectangle, style = filled, fillcolor = white]

  evaluate_qc_level [label = 'If within a level a QC Level (Low Medium High) there is a Not Found for analyte_peak, set all values in that level to Not Found
  Set the corresponding missing_analyte_level_flag to false
  ', shape = rectangle, style = filled, fillcolor = white]

  calc_average_and_stddev [label = 'For each Analyte QC Level, calculate
  1. Average
  2. Standard Deviation
  3. Percent Relative Standard Deviation (RSD) = (Standard Deviation / Average) * 100
  ', shape = rectangle, style = filled, fillcolor = white]


      qc_analyte [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>blank_filtered_analyte_concentration_quality_control</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>quality_control_level: text</td></tr>
            <tr><td align='left'>missing_analyte_level_flag: text</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>average_qc_analyte_concnetration_ng: numeric</td></tr>
            <tr><td align='left'>std_dev_qc_analyte_concnetration_ng: numeric</td></tr>
            <tr><td align='left'>percent_rsd_qc_analyte_concnetration_ng: numeric</td></tr>
        </table>
    >]


    quality_control_calculation_input -> subtract_sample_adjustment -> evaluate_qc_level -> calc_average_and_stddev -> qc_analyte
    quality_control_sample_adjustment -> subtract_sample_adjustment



}")
```

#### Evaluate Quality Control Levels

```{r echo=FALSE}
DiagrammeR::grViz("digraph {

  node [shape=none, margin=0]



    // sourced tables
    blank_filtered_analyte_concentration_quality_control [label = 'blank_filtered_analyte_concentration_quality_control', shape = folder, style = filled, fillcolor = lightblue]

    native_analyte_quality_control_levels [label = 'native_analyte_quality_control_levels', shape = folder, style = filled, fillcolor = linen]

    analyte_concentration_name_mapping [label = 'analyte_concentration_name_mapping', shape = folder, style = filled, fillcolor = linen]



joinTables [label = 'Join blank_filtered_analyte_concentration_quality_control to analyte_concentration_quality_control
using analyte_concentration_name_mapping to map analyte names

1. individual_native_analyte_name
2. quality_control_mix_level
', shape = rectangle, style = filled, fillcolor = white]

evalRatio [label = 'Evaluate quality control recovery

1. Theoretical = native_analyte_spkied_in_qc_samples_ng
2. Experimental = average_qc_analyte_concnetration_ng

QC Recovery Ratio = (Experimental / Theoretical) * 100
QC Recovery Ratio = (average_qc_analyte_concnetration_ng / native_analyte_spkied_in_qc_samples_ng) * 100
', shape = rectangle, style = filled, fillcolor = white]

evalBounds [label = 'Evaluate Ratio Boundary:
1. If QC Recovery Ratio is between 70% to 130% = PASS
2. If QC Recovery Ratio is outside 70% to 130% = FAIL
3. If Experimental Value is NF = Experimental Not Found', shape = rectangle, style = filled, fillcolor = white]

      blank_filtered_analyte_quality_control_evaluation [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>blank_filtered_analyte_quality_control_evaluation</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>qc_level: text</td></tr>
            <tr><td align='left'>blank_filtered_average_qc_analyte_concentration_ng: numeric</td></tr>
            <tr><td align='left'>native_analyte_spiked_in_qc_samples_ng: numeric</td></tr>
            <tr><td align='left'>qc_recovery_ratio: numeric</td></tr>
            <tr><td align='left'>qc_recovery_ratio_test: text</td></tr>
        </table>
    >]

blank_filtered_analyte_concentration_quality_control -> joinTables
native_analyte_quality_control_levels -> joinTables
analyte_concentration_name_mapping -> joinTables

joinTables -> evalRatio -> evalBounds -> blank_filtered_analyte_quality_control_evaluation



}")
```


#### Field Blank Filtering

#### Calcualte Average Field Blank Value

```{r echo=FALSE}
DiagrammeR::grViz("digraph {

  node [shape=none, margin=0]

    // sourced tables
    blank_filtered_analyte_concentration [label = 'blank_filtered_analyte_concentration', shape = folder, style = filled, fillcolor = lightblue]

    extraction_batch_source [label = 'extraction_batch_source', shape = folder, style = filled, fillcolor = linen]
    
    
getFiledBlanks [label = 'Get Field Blank blank_filtered_analyte_concentration_ng values
by filtering cartridges to Field Blank in extraction_batch_source
and joining to blank_filtered_analyte_concentration', shape = rectangle, style = filled, fillcolor = white]

averageFieldBlank [label = 'Get the average blank_filtered_analyte_concentration_ng
across all batches for each analyte', shape = rectangle, style = filled, fillcolor = white]

     field_blank_average_blank_filtered_analyte_concentration [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>field_blank_average_blank_filtered_analyte_concentration</td></tr>
            // columns
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>field_blank_average_analyte_concentration_ng: numeric</td></tr>
        </table>
    >]

blank_filtered_analyte_concentration -> getFiledBlanks
extraction_batch_source -> getFiledBlanks

getFiledBlanks -> averageFieldBlank -> field_blank_average_blank_filtered_analyte_concentration


}")
```

##### Subtract Average Field Blank from Blanked Filtered Analyte Values

```{r echo=FALSE}
DiagrammeR::grViz("digraph {

  node [shape=none, margin=0]
  
  blank_filtered_analyte_concentration [label = 'blank_filtered_analyte_concentration', shape = folder, style = filled, fillcolor = lightblue]
  
  field_blank_average_blank_filtered_analyte_concentration [label = 'field_blank_average_blank_filtered_analyte_concentration', shape = folder, style = filled, fillcolor = lightblue]
  
  joinFieldBlanks [label = 'Join the field_blank_average_blank_filtered_analyte_concentration
  to each individual_native_analyte_name
  in the blank_filtered_analyte_concentration', shape = rectangle, style = filled, fillcolor = white]
  
  subtractFieldBlanks [label = 'Subtract the field_blank_average_analyte_concentration_ng
  from each blank_filtered_analyte_concentration_ng', shape = rectangle, style = filled, fillcolor = white]
  
  
blank_filtered_analyte_concentration -> joinFieldBlanks
field_blank_average_blank_filtered_analyte_concentration -> joinFieldBlanks

joinFieldBlanks -> subtractFieldBlanks

     field_blank_blank_filtered_analyte_concentration [label=<
        <table border='0' cellborder='1' cellspacing='0' cellpadding='4'>
            <tr><td bgcolor='lightblue'>field_blank_blank_filtered_analyte_concentration</td></tr>
            // columns
            <tr><td align='left'>batch_number: numeric</td></tr>
            <tr><td align='left'>individual_native_analyte_name: text</td></tr>
            <tr><td align='left'>field_blank_average_analyte_concentration_ng: numeric</td></tr>
        </table>
    >]
}")
```