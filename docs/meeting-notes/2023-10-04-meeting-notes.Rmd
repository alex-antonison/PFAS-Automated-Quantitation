# Issues in Files

## Batch 1

Found `new` in filenames and some had letters on the end.

* For `new`, filter these out
* For filenames with a letter on the end, remove the letter

## Batch 3

internal_standard `d5-NEtFOSA-M` has a 0.0 for the level. This is causing a downstream of creating an INF value. As a hotfix I am filtering any instances where area is set to 0 out.

### Looking at batches

```{r}
library(magrittr)
eval_df <- arrow::read_parquet("../../data/processed/build-data-products/blank_filtered_evaluated_qc_no_recovery.parquet")
```

### Pass / Fail Check

```{r}
eval_df %>%
  # dplyr::filter(batch_number == 1) %>%
  dplyr::select(-quality_control_exists_flag, -quality_control_adjust_flag) %>%
  dplyr::filter(!is.na(evaluate_recovery_ratio_flag)) %>%
  dplyr::group_by(batch_number, evaluate_recovery_ratio_flag) %>%
  dplyr::summarise(count = dplyr::n())
```

```{r}
eval_df %>%
  dplyr::filter(batch_number == 1) # %>%
# dplyr::filter(is.na(evaluate_recovery_ratio_flag)) # %>%
# dplyr::filter(evaluate_recovery_ratio_flag == "PASS")
```

#### After Each Batch

1. Excel sheet that includes 2 tabs

Tab1. Summary of all PASS / FAIL by batch
Tab2. Export of the dataframe that includes all results across all batches
Tab3. Include Calibration Curve Information
Tab4. Include Analyte Concentration
Tab5. Include Blank Filtered



### Reviewing Field Blank

```{r}
field_blank_average <- readr::read_csv("../../data/processed/build-data-products/field_blank_analyte_concentration_average_ng.csv")
# %>%
# dplyr::filter(!is.na(field_blank_average_analyte_concentration_ng))
```

```{r}
field_blank_average %>%
  dplyr::filter(individual_native_analyte_name == "PFOS") %>%
  # dplyr::arrange(batch_number, cartridge_number, individual_native_analyte_name) %>%
  # dplyr::filter(blank_filtered_analyte_concentration_ng < 0) %>%
  dplyr::arrange(blank_filtered_analyte_concentration_ng)
```
```{r}
analyte_concentration <- arrow::read_parquet(
  "../../data/processed/quantify-sample/analyte_concentration_no_recovery.parquet"
)
```

```{r}
analyte_concentration %>%
  # dplyr::filter(batch_number == 1) %>%
  # dplyr::filter(cartridge_number == 23) %>%
  dplyr::filter(individual_native_analyte_name == "PFOS")
```

```{r}
cali_curve <- arrow::read_parquet(
  "../../data/processed/calibration-curve/calibration_curve_output_no_recov_filter.parquet"
)
```

```{r}
cali_curve %>%
  dplyr::filter(batch_number == 1) %>%
  dplyr::filter(individual_native_analyte_name == "Syn55")
```


```{r}
field_blank_average %>%
  dplyr::arrange(field_blank_average_analyte_concentration_ng)
```
